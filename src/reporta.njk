---
permalink: "reporta/index.html"
---

{% extends "src/base.njk" %}

{% block head %}
<title>Reporte Nuevo | Red Ciudadana</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


{% endblock %}

{% block content %}

<!-- Dashboard Container -->
<div class="dashboard-container">

	<!-- Dashboard Sidebar
	================================================== -->
	
    <style>
        body{
            overflow-y:hidden
        }
    </style>

	<!-- Dashboard Content
	================================================== -->
	<div class="dashboard-content-container" data-simplebar>
		<div class="dashboard-content-inner" >
			
			<!-- Dashboard Headline -->
			<div class="dashboard-headline">
				<h3>Reporta</h3>

				<!-- Breadcrumbs -->
				<nav id="breadcrumbs" class="dark">
					<ul>
						<li><a href="/index.html">Inicio</a></li>
						<li>Reporta</li>
					</ul>
				</nav>
			</div>
	
			<!-- Row -->
			<div class="row">

				<!-- Dashboard Box -->
				<div class="col-xl-12">
					<div class="dashboard-box margin-top-0">

						<!-- Headline -->
						<div class="headline">
							<h3><i class="icon-feather-folder-plus"></i> Formulario para Reportar</h3>
						</div>

						<div class="content with-padding padding-bottom-10">
							
							<form id="form" width="100%" target="_self" onsubmit="return postToForm();" action="" autocomplete="off">
								<div class="row">
									<div class="col-xl-6">
										<div class="submit-field">
											<h5>Categoría</h5>
											<select id="category" name="entry.498725489" required class="selectpicker with-border" data-size="7" title="Selecciona una Categoría">
												<option>Categoría 1</option>
												<option>Categoría 2</option>
												<option>Categoría 3</option>
												<option>Categoría 4</option>
												<option>Categoría 5</option>
											</select>
										</div>
									</div>

									<div class="col-xl-6">
										<div class="submit-field">
											<h5>Sub Categoría</h5>
											<select id="subcategory" name="entry.481737689" required class="selectpicker with-border" data-size="7" title="Selecciona una Subcategoría">
												<option>Subcategoría 1</option>
												<option>Subcategoría 2</option>
												<option>Subcategoría 3</option>
												<option>Subcategoría 4</option>
												<option>Subcategoría 5</option>
												<option>Subcategoría 6</option>
												<option>Subcategoría 7</option>
												<option>Subcategoría 8</option>
												<option>Subcategoría 9</option>
												<option>Subcategoría 10</option>
											</select>
										</div>
									</div>

									

									<div class="col-xl-12">
										<div class="submit-field">
											<h5>Título del Reporte</h5>
											<input id="title" name="entry.1794477957" required type="text" class="with-border">
										</div>
									</div>

									<div class="col-xl-12">
										<div class="submit-field">
											<h5>Descripción del Reporte</h5>
											<textarea id="description" name="entry.1606735796" required cols="30" rows="5" class="with-border"></textarea>
										</div>
									</div>

									<div class="col-xl-12">
										<div class="submit-field">
											<h5>Ubicación</h5>
											<div id="markerInfo">Haz clic en el mapa para seleccionar una ubicación</div>
											<div id="map-container">
												<div id="map"></div>
												<div id="addressInputContainer">
													<input type="text" id="addressInput" placeholder="Ingrese una dirección">
												</div>
											</div>
											<div class="row">
												<div class="col-xl-6">
													<div class="submit-field">
														<div>Latitud: <input id="latitude" name="entry.1615723381" type="text"></div>
													</div>
												</div>

												<div class="col-xl-6">
													<div class="submit-field">
														<div>Longitud: <input id="longitude" name="entry.1203873627" type="text"></div>
													</div>
												</div>
											</div>
										</div>
									</div>
					
									<div class="col-xl-6">
										<div class="submit-field">
											<h5>Nombre (Opcional)</h5>
											<input id="name" name="entry.467289130" type="text" class="with-border">
										</div>
									</div>

									<div class="col-xl-6">
										<div class="submit-field">
											<h5>Correo (Opcional)</h5>
											<input id="email" name="entry.56038912" type="text" class="with-border">
										</div>
									</div>

									<div class="col-xl-12" style="margin-bottom:25px">
										<button id="send" type="submit" class="button ripple-effect big margin-top-30 btn"><i class="icon-feather-plus"></i>Envíanos tu Reportes</button>
									</div>
								</div>
							</form>

							<h3 id="success-msg" style="display:none;margin-bottom:25px"> Su reporte ha sido enviado</h3>
						</div>
					</div>
				</div>

			</div>
			<!-- Row / End -->

			<!-- Footer -->
			<div class="dashboard-footer-spacer"></div>
			<div class="small-footer margin-top-15">
				<div class="small-footer-copyrights">
					© 2019 <strong>Hireo</strong>. All Rights Reserved.
				</div>
				<ul class="footer-social-links">
					<li>
						<a href="#" title="Facebook" data-tippy-placement="top">
							<i class="icon-brand-facebook-f"></i>
						</a>
					</li>
					<li>
						<a href="#" title="Twitter" data-tippy-placement="top">
							<i class="icon-brand-twitter"></i>
						</a>
					</li>
					<li>
						<a href="#" title="Google Plus" data-tippy-placement="top">
							<i class="icon-brand-google-plus-g"></i>
						</a>
					</li>
					<li>
						<a href="#" title="LinkedIn" data-tippy-placement="top">
							<i class="icon-brand-linkedin-in"></i>
						</a>
					</li>
				</ul>
				<div class="clearfix"></div>
			</div>
			<!-- Footer / End -->

		</div>
	</div>
	<!-- Dashboard Content / End -->

</div>
<!-- Dashboard Container / End -->

</div>
<!-- Wrapper / End -->

{% endblock %}

{% block footer %}
{% endblock %}

{% block body_javascripts %}
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
function initMap() {
    var map = L.map('map', {
        zoomControl: false // Desactivar los controles de zoom
    }).setView([14.634915, -90.506882], 14); // Coordenadas iniciales centradas en Ciudad de Guatemala con zoom 14

    // Agregar el mapa base de OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    var marker;

    function updateMapLocation(lat, lng) {
        // Remove the existing marker from the map (if any)
        if (marker) {
            map.removeLayer(marker);
        }

        // Create a new marker at the given latitude and longitude
        marker = L.marker([lat, lng]).addTo(map);

        // Center the map at the new marker's position
        map.setView([lat, lng], 14);
    }

    // Handle clicks on the map to update latitude and longitude inputs
    map.on('click', function(e) {
        var latLng = e.latlng;
        var lat = latLng.lat.toFixed(6);
        var lng = latLng.lng.toFixed(6);

        // Update the latitude and longitude inputs
        document.getElementById('latitude').value = lat;
        document.getElementById('longitude').value = lng;

        // Update the map location
        updateMapLocation(lat, lng);
    });

    // Handle changes to the latitude and longitude inputs
    document.getElementById('latitude').addEventListener('change', function () {
        var lat = parseFloat(this.value);
        var lng = parseFloat(document.getElementById('longitude').value);
        if (!isNaN(lat) && !isNaN(lng)) {
            updateMapLocation(lat, lng);
        }
    });

    document.getElementById('longitude').addEventListener('change', function () {
        var lat = parseFloat(document.getElementById('latitude').value);
        var lng = parseFloat(this.value);
        if (!isNaN(lat) && !isNaN(lng)) {
            updateMapLocation(lat, lng);
        }
    });

    // Handle changes to the address input for geocoding
    document.getElementById('addressInput').addEventListener('change', function() {
        var address = this.value;
        if (!address) return; // If the address field is empty, do nothing

        // Perform a geocoding request to Nominatim
        var nominatimUrl = 'https://nominatim.openstreetmap.org/search';
        var params = {
            q: address,
            format: 'json',
            limit: 1
        };

        axios.get(nominatimUrl, { params })
            .then(function(response) {
                var data = response.data;
                if (data.length > 0) {
                    var lat = parseFloat(data[0].lat);
                    var lng = parseFloat(data[0].lon);

                    // Update the latitude and longitude inputs
                    document.getElementById('latitude').value = lat;
                    document.getElementById('longitude').value = lng;

                    // Update the map location
                    updateMapLocation(lat, lng);
                } else {
                    alert('Dirección no encontrada');
                }
            })
            .catch(function(error) {
                console.error('Error al geocodificar la dirección:', error);
            });
    });
}

// Llamada a la función para inicializar el mapa cuando se cargue la página
document.addEventListener('DOMContentLoaded', initMap);
</script>

<!-- Google Autocomplete -->
<script>
	function initAutocomplete() {
		 var options = {
		  types: ['(cities)'],
		  // componentRestrictions: {country: "us"}
		 };

		 var input = document.getElementById('autocomplete-input');
		 var autocomplete = new google.maps.places.Autocomplete(input, options);

		if ($('.submit-field')[0]) {
		    setTimeout(function(){ 
		        $(".pac-container").prependTo("#autocomplete-container");
		    }, 300);
		}
	}
</script>

<script>
	function postToForm() {
		var field1 = $("#category option:selected").text();
		var field2 = $("#subcategory option:selected").text();
		var field3 = $("#title").val();
		var field4 = $("#description").val();
		var field5 = $("#latitude").val();
		var field6 = $("#longitude").val();
		var field7 = $("#name").val();
		var field8 = $("#email").val();


		$.ajax({
			url: "https://docs.google.com/forms/d/e/1FAIpQLSeGpleiCfrBwWQO3gAFz7_u4uVvrDK4KgBw8KjQ_7Aahaj1uQ/formResponse?",
			data: {"entry.498725489": field1, "entry.481737689": field2, "entry.1794477957": field3, "entry.1606735796": field4, "entry.1615723381": field5, "entry.1203873627": field6, "entry.467289130": field7, "entry.56038912": field8},
			type: "POST",
			dataType: "xml",
			success: function(d)
			{
			},
			error: function(x, y, z)
				{

					$('#success-msg').show();
					$('#form').hide();
					
				}
		});
		return false;
	}
</script>


{% endblock %}